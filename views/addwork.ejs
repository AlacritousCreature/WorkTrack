<%- include('./partials/header') %>
<div class="container">
    <form>
        <div class="form-group">
            <label for="exampleInputEmail1">Title</label>
            <input type="text" class="form-control" aria-describedby="emailHelp" id="title" required>
        </div>
        <div class="form-group">
            <label for="exampleFormControlTextarea1">Description</label>
            <textarea class="form-control" rows="3" id="desc"></textarea>
        </div>

        <button class="btn btn-primary" id="started">Start Task</button>

    </form>

    <script src="https://code.jquery.com/jquery-3.1.1.js"
        integrity="sha256-16cdPddA6VdVInumRGo6IbivbERE8p7CQR3HzTBuELA=" crossorigin="anonymous"></script>
    <script>
        const button = document.getElementById('started');

        button.addEventListener("click", (e) => {
            e.preventDefault();
            var post = {};

            if (button.innerHTML === "Start Task") {
                button.innerHTML = "End Task";
                localStorage.startTime = new Date();
            }

            else if (button.innerHTML === "End Task") {
                button.innerHTML = "Submit";
                localStorage.endTime = new Date();
            }

            else if (button.textContent === "Submit") {
                post.title = $('#title').val();
                post.desc = $('#desc').val();
                post.startTime = new Date(localStorage.startTime);
                post.endTime = new Date(localStorage.endTime);

                console.log(post); //Here, the post object is defined

                if (!post.title) {
                    return alert("Please fill out the title");
                }

                $.ajax({ url: '/home', type: 'POST', data: { post: post } })
                    .then(res => {
                        window.location = "/home";
                        localStorage.removeItem('startTime');
                        localStorage.removeItem('endTime');
                    })
                    .catch(err => console.log("error", err));
            }
        });
    </script>

</div>
<%- include('./partials/footer') %>